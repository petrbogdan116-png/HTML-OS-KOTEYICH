<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ú–æ—è HTML OS</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            overflow: hidden;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            color: white;
        }
        #install-screen {
            width: 100vw;
            height: 100vh;
            background: linear-gradient(to bottom, #0f0f23, #1a1a2e);
            display: flex;
            justify-content: center;
            align-items: center;
            position: fixed;
            top: 0;
            left: 0;
            z-index: 1001;
            flex-direction: column;
        }
        #install-button {
            background: linear-gradient(45deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px 30px;
            font-size: 20px;
            border: none;
            cursor: pointer;
            border-radius: 25px;
            margin-top: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }
        #install-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.3);
        }
        #install-text {
            font-size: 24px;
            margin-bottom: 20px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.5);
        }
        #boot-screen {
            width: 100vw;
            height: 100vh;
            background: linear-gradient(to bottom, #000, #333);
            display: none;
            justify-content: center;
            align-items: center;
            position: fixed;
            top: 0;
            left: 0;
            z-index: 1000;
        }
        #boot-button {
            background: linear-gradient(45deg, #ff6b6b, #ee5a24);
            color: white;
            padding: 15px 30px;
            font-size: 20px;
            border: none;
            cursor: pointer;
            border-radius: 25px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }
        #boot-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.3);
        }
        #loading-screen {
            width: 100vw;
            height: 100vh;
            background: linear-gradient(to bottom, #000, #333);
            display: none;
            justify-content: center;
            align-items: center;
            position: fixed;
            top: 0;
            left: 0;
            z-index: 999;
            flex-direction: column;
        }
        #loading-progress {
            width: 300px;
            height: 20px;
            background-color: #333;
            margin-top: 50px;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.5);
        }
        #loading-bar {
            width: 0%;
            height: 100%;
            background: linear-gradient(90deg, #00c6ff, #0072ff);
            transition: width 10s ease-in-out;
            border-radius: 10px;
        }
        #loading-text {
            margin-top: 10px;
            font-size: 18px;
            color: white;
            text-shadow: 0 2px 4px rgba(0,0,0,0.5);
        }
        #desktop {
            width: 100vw;
            height: 100vh;
            position: relative;
            background: linear-gradient(to bottom, #1e3c72, #2a5298);
            display: none;
        }
        .icon {
            position: absolute;
            cursor: pointer;
            text-align: center;
            width: 80px;
            transition: transform 0.2s;
        }
        .icon:hover {
            transform: scale(1.1);
        }
        .icon img {
            width: 48px;
            height: 48px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.3);
        }
        .icon span {
            display: block;
            font-size: 12px;
            color: white;
            text-shadow: 1px 1px 2px black;
            margin-top: 5px;
        }
        #taskbar {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 50px;
            background: rgba(26, 26, 26, 0.95);
            display: flex;
            align-items: center;
            padding: 0 10px;
            box-shadow: 0 -2px 20px rgba(0,0,0,0.5);
            backdrop-filter: blur(10px);
        }
        #start-button {
            background: linear-gradient(45deg, #00d4ff, #0099cc);
            color: white;
            padding: 8px 15px;
            border: none;
            cursor: pointer;
            border-radius: 20px;
            margin-right: 10px;
            font-weight: bold;
        }
        #internet-button {
            background: none;
            border: none;
            color: white;
            font-size: 20px;
            cursor: pointer;
            margin-left: 10px;
            padding: 5px;
            border-radius: 50%;
            transition: background 0.2s;
        }
        #internet-button:hover {
            background: rgba(255,255,255,0.1);
        }
        #clock {
            margin-left: auto;
            font-size: 14px;
            font-weight: bold;
        }
        #start-menu {
            position: fixed;
            bottom: 50px;
            left: 10px;
            background: rgba(255,255,255,0.95);
            color: black;
            padding: 15px;
            display: none;
            border-radius: 10px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
            backdrop-filter: blur(10px);
        }
        #start-menu button {
            display: block;
            width: 100%;
            padding: 10px;
            margin: 5px 0;
            cursor: pointer;
            border: none;
            border-radius: 5px;
            background: #f0f0f0;
            transition: background 0.2s;
        }
        #start-menu button:hover {
            background: #e0e0e0;
        }
        .window {
            position: absolute;
            background: rgba(255,255,255,0.95);
            color: black;
            border: 1px solid #ccc;
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
            min-width: 300px;
            min-height: 200px;
            display: none;
            flex-direction: column;
            border-radius: 10px;
            overflow: hidden;
        }
        .window-header {
            background: linear-gradient(45deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 10px 15px;
            cursor: move;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .window-controls {
            display: flex;
            gap: 5px;
        }
        .window-minimize, .window-maximize, .window-close {
            background: none;
            border: none;
            color: white;
            font-weight: bold;
            cursor: pointer;
            padding: 0 8px;
            width: 25px;
            height: 25px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: background 0.2s;
        }
        .window-minimize:hover, .window-maximize:hover, .window-close:hover {
            background: rgba(255,255,255,0.2);
        }
        .window-content {
            padding: 15px;
            flex-grow: 1;
            overflow: auto;
        }
        #browser-content {
            display: flex;
            flex-direction: column;
        }
        #browser-address {
            width: 100%;
            padding: 10px;
            margin-bottom: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        #browser-page {
            flex-grow: 1;
            background-color: #f9f9f9;
            padding: 15px;
            border-radius: 5px;
            overflow: auto;
        }
        .download-button {
            background: linear-gradient(45deg, #4CAF50 0%, #45a049 100%);
            color: white;
            padding: 10px 15px;
            border: none;
            cursor: pointer;
            margin: 10px 0;
            border-radius: 5px;
            font-weight: bold;
        }
        .download-button:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
        }
        .buy-button {
            background: linear-gradient(45deg, #ff9800 0%, #f57c00 100%);
            color: white;
            padding: 10px 15px;
            border: none;
            cursor: pointer;
            margin: 10px 0;
            border-radius: 5px;
            font-weight: bold;
        }
        .buy-button:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
        }
        .virus-button {
            background: linear-gradient(45deg, #f44336 0%, #d32f2f 100%);
            color: white;
            padding: 10px 15px;
            border: none;
            cursor: pointer;
            margin: 10px 0;
            border-radius: 5px;
            font-weight: bold;
        }
        .virus-button:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
        }
        #antivirus-icon, #minecraft-icon, #calculator-icon {
            display: none;
            top: 20px;
            left: 120px;
        }
        #minecraft-icon {
            left: 320px;
        }
        #calculator-icon {
            top: 20px;
            left: 520px;
        }
        #virus-alert {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(45deg, #ff0000, #cc0000);
            color: white;
            padding: 20px;
            display: none;
            z-index: 1000;
            text-align: center;
            border-radius: 10px;
            box-shadow: 0 4px 20px rgba(255,0,0,0.5);
            animation: pulse 1s infinite;
        }
        @keyframes pulse {
            0% { transform: translate(-50%, -50%) scale(1); }
            50% { transform: translate(-50%, -50%) scale(1.05); }
            100% { transform: translate(-50%, -50%) scale(1); }
        }
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
            20%, 40%, 60%, 80% { transform: translateX(5px); }
        }
        .infected {
            animation: shake 0.5s infinite;
        }
        #bsod {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background-color: #0000a0;
            color: white;
            display: none;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            z-index: 2000;
            font-family: 'Courier New', monospace;
            text-align: center;
            padding: 20px;
        }
        #bsod h1 {
            font-size: 48px;
            margin-bottom: 20px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }
        #bsod p {
            font-size: 18px;
            margin-bottom: 40px;
            line-height: 1.5;
        }
        #bsod button {
            background: #00ff00;
            color: black;
            padding: 10px 20px;
            font-size: 16px;
            border: none;
            cursor: pointer;
            border-radius: 5px;
            font-weight: bold;
        }
        .file-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            border-bottom: 1px solid #eee;
            transition: background 0.2s;
        }
        .file-item:hover {
            background: #f0f0f0;
        }
        .file-name {
            flex-grow: 1;
        }
        .file-size {
            font-size: 12px;
            color: #666;
        }
        .file-delete {
            background: #ff4444;
            color: white;
            border: none;
            padding: 5px 10px;
            cursor: pointer;
            border-radius: 3px;
            font-size: 12px;
        }
        .file-delete:hover {
            background: #cc0000;
        }
        .file-restore {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 10px 15px;
            cursor: pointer;
            border-radius: 5px;
            font-weight: bold;
            margin-top: 10px;
        }
        .file-restore:hover {
            background: #45a049;
        }
        .disk-info {
            background: #f0f0f0;
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 10px;
            font-weight: bold;
        }
        #disk-d-info {
            display: none;
        }
        #calculator-window {
            width: 300px;
            height: 400px;
        }
        #calculator-display {
            width: 100%;
            height: 60px;
            font-size: 24px;
            text-align: right;
            padding: 0 10px;
            border: none;
            background: #f0f0f0;
            margin-bottom: 10px;
        }
        .calc-button {
            width: 70px;
            height: 60px;
            font-size: 18px;
            border: none;
            background: #e0e0e0;
            cursor: pointer;
            border-radius: 5px;
            margin: 2px;
        }
        .calc-button:hover {
            background: #d0d0d0;
        }
        .calc-operator {
            background: #ff9500;
            color: white;
        }
        .calc-operator:hover {
            background: #e68900;
        }
        #messenger-window {
            width: 500px;
            height: 600px;
        }
        #messenger-login, #messenger-chat {
            display: none;
        }
        #messenger-register {
            display: block;
        }
        .form-group {
            margin-bottom: 10px;
        }
        .form-group label {
            display: block;
            margin-bottom: 5px;
        }
        .form-group input {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        .form-button {
            background: #4CAF50;
            color: white;
            padding: 10px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            width: 100%;
            margin-top: 10px;
        }
        .form-button:hover {
            background: #45a049;
        }
        #chat-messages {
            height: 300px;
            overflow-y: scroll;
            border: 1px solid #ddd;
            padding: 10px;
            background: white;
            margin-bottom: 10px;
            border-radius: 4px;
        }
        .message {
            margin-bottom: 5px;
            padding: 5px;
            background: #f0f0f0;
            border-radius: 4px;
        }
        #chat-input {
            width: 80%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        #send-button {
            width: 18%;
            padding: 8px;
            background: #4CAF50;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        #notebook-window {
            background: black;
            color: #00ff00;
            font-family: 'Courier New', monospace;
        }
        #notebook-window .window-header {
            background: #333;
        }
        #notebook-window .window-content {
            padding: 20px;
            text-align: center;
            font-size: 18px;
            line-height: 1.5;
        }
        #minecraft-window {
            width: 620px;
            height: 420px;
        }
        #minecraft-container {
            width: 100%;
            height: 100%;
            image-rendering: pixelated;
        }
        .network-option {
            display: flex;
            align-items: center;
            margin: 10px 0;
        }
        .network-option input[type="password"] {
            margin-left: 10px;
            padding: 5px;
            border: 1px solid #ddd;
            border-radius: 3px;
        }
        #peer-status {
            color: #666;
            font-size: 12px;
            margin-top: 5px;
        }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128/examples/js/controls/PointerLockControls.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128/examples/js/postprocessing/EffectComposer.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128/examples/js/postprocessing/RenderPass.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128/examples/js/postprocessing/ShaderPass.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128/examples/js/shaders/CopyShader.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128/examples/js/shaders/PixelShader.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.13.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.13.1/firebase-database-compat.js"></script>
</head>
<body>
    <!-- –≠–∫—Ä–∞–Ω —É—Å—Ç–∞–Ω–æ–≤–∫–∏ OS -->
    <div id="install-screen">
        <div id="install-text">–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ —É—Å—Ç–∞–Ω–æ–≤–∫—É OS!</div>
        <button id="install-button">–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å OS</button>
    </div>

    <!-- –≠–∫—Ä–∞–Ω –∑–∞–≥—Ä—É–∑–∫–∏ (–≤—ã–∫–ª—é—á–µ–Ω–Ω—ã–π –ü–ö) -->
    <div id="boot-screen">
        <button id="boot-button">–ó–ê–ü–£–°–ö PC</button>
    </div>

    <!-- –ê–Ω–∏–º–∞—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ -->
    <div id="loading-screen">
        <div id="loading-progress">
            <div id="loading-bar"></div>
        </div>
        <div id="loading-text">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
    </div>

    <!-- BSOD -->
    <div id="bsod">
        <h1>*** STOP: 0x0000007B (0xF78D2524, 0xC0000034, 0x00000000, 0x00000000)</h1>
        <p>INACCESSIBLE_BOOT_DEVICE<br><br>
        –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è:<br>
        *** STOP: 0x0000007B INACCESSIBLE_BOOT_DEVICE<br><br>
        –Ø–¥—Ä–æ —Å–∏—Å—Ç–µ–º—ã –ø–æ–≤—Ä–µ–∂–¥–µ–Ω–æ. –°–∏—Å—Ç–µ–º–∞ –Ω–µ –º–æ–∂–µ—Ç –∑–∞–≥—Ä—É–∑–∏—Ç—å—Å—è.<br>
        –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É –¥–ª—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è.</p>
        <button onclick="startSystemRestore()">–í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å–∏—Å—Ç–µ–º—É</button>
    </div>

    <div id="desktop">
        <!-- –ò–∫–æ–Ω–∫–∏ –Ω–∞ –¥–µ—Å–∫—Ç–æ–ø–µ -->
        <div class="icon" id="files-icon" style="top: 20px; left: 20px;" ondblclick="openWindow('files')">
            <img src="https://img.icons8.com/color/48/folder.png" alt="Files">
            <span>–§–∞–π–ª—ã</span>
        </div>
        <div class="icon" id="browser-icon" style="top: 20px; left: 220px;" ondblclick="openWindow('browser')">
            <img src="https://img.icons8.com/color/48/internet-browser.png" alt="Browser">
            <span>–ë—Ä–∞—É–∑–µ—Ä</span>
        </div>
        <div class="icon" id="antivirus-icon" ondblclick="openWindow('antivirus')">
            <img src="https://img.icons8.com/color/48/antivirus.png" alt="Antivirus">
            <span>–ê–Ω—Ç–∏–≤–∏—Ä—É—Å</span>
        </div>
        <div class="icon" id="minecraft-icon" ondblclick="openWindow('minecraft')">
            <img src="https://preview.redd.it/kb9w9c28o2871.jpg?auto=webp&s=f2b847c154a28736eda1b034135fc374af3723d8" alt="Minecraft">
            <span>Minecraft 3D</span>
        </div>
        <div class="icon" id="calculator-icon" ondblclick="openWindow('calculator')">
            <img src="https://img.icons8.com/color/48/calculator.png" alt="Calculator">
            <span>–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä</span>
        </div>
    </div>
    
    <!-- –ü–∞–Ω–µ–ª—å –∑–∞–¥–∞—á -->
    <div id="taskbar">
        <button id="start-button">Start</button>
        <button id="internet-button" onclick="openWindow('internet')">üåê</button>
        <div id="clock"></div>
    </div>
    
    <!-- –ú–µ–Ω—é Start -->
    <div id="start-menu">
        <button onclick="shutdown()">–í—ã–∫–ª—é—á–∏—Ç—å</button>
        <button onclick="restart()">–ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å</button>
    </div>
    
    <!-- –û–∫–Ω–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É -->
    <div class="window" id="internet-window" style="top: 100px; left: 200px; width: 400px;">
        <div class="window-header">
            <span>–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —Å–µ—Ç–∏</span>
            <div class="window-controls">
                <button class="window-minimize" onclick="minimizeWindow('internet')">-</button>
                <button class="window-maximize" onclick="toggleMaximizeWindow('internet')">‚ñ°</button>
                <span class="window-close" onclick="closeWindow('internet')">X</span>
            </div>
        </div>
        <div class="window-content">
            <h3>–î–æ—Å—Ç—É–ø–Ω—ã–µ —Å–µ—Ç–∏:</h3>
            <div class="network-option">
                <input type="radio" name="router" value="bad">
                <label>–ü–ª–æ—Ö–æ–π —Ä–æ—É—Ç–µ—Ä</label>
                <button onclick="connectToRouter('bad')">–ü–æ–¥–∫–ª—é—á–∏—Ç—å</button>
            </div>
            <div class="network-option">
                <input type="radio" name="router" value="good">
                <label>–•–æ—Ä–æ—à–∏–π —Ä–æ—É—Ç–µ—Ä</label>
                <input type="password" id="password" placeholder="–ü–∞—Ä–æ–ª—å">
                <button onclick="connectToRouter('good')">–ü–æ–¥–∫–ª—é—á–∏—Ç—å</button>
            </div>
        </div>
    </div>

    <!-- –û–∫–Ω–æ —Ñ–∞–π–ª–æ–≤ -->
    <div class="window" id="files-window" style="top: 100px; left: 100px;">
        <div class="window-header">
            <span>–§–∞–π–ª—ã</span>
            <div class="window-controls">
                <button class="window-minimize" onclick="minimizeWindow('files')">-</button>
                <button class="window-maximize" onclick="toggleMaximizeWindow('files')">‚ñ°</button>
                <span class="window-close" onclick="closeWindow('files')">X</span>
            </div>
        </div>
        <div class="window-content">
            <div id="disk-c-info" class="disk-info">–î–∏—Å–∫ C: 100 –ì–ë (—Å–≤–æ–±–æ–¥–Ω–æ: <span id="free-space-c">100</span> –ì–ë)</div>
            <div id="disk-d-info" class="disk-info">–î–∏—Å–∫ D: 200 –ì–ë (—Å–≤–æ–±–æ–¥–Ω–æ: <span id="free-space-d">200</span> –ì–ë)</div>
            <div id="files-list"></div>
            <button class="file-restore" onclick="restoreAllFiles()" id="restore-btn" style="display: none;">–í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤—Å–µ —Å–∏—Å—Ç–µ–º–Ω—ã–µ —Ñ–∞–π–ª—ã</button>
        </div>
    </div>

    <!-- –û–∫–Ω–æ –±—Ä–∞—É–∑–µ—Ä–∞ -->
    <div class="window" id="browser-window" style="top: 50px; left: 200px; width: 600px; height: 400px;">
        <div class="window-header">
            <span>–ë—Ä–∞—É–∑–µ—Ä</span>
            <div class="window-controls">
                <button class="window-minimize" onclick="minimizeWindow('browser')">-</button>
                <button class="window-maximize" onclick="toggleMaximizeWindow('browser')">‚ñ°</button>
                <span class="window-close" onclick="closeWindow('browser')">X</span>
            </div>
        </div>
        <div class="window-content" id="browser-content">
            <input type="text" id="browser-address" placeholder="–í–≤–µ–¥–∏—Ç–µ –∞–¥—Ä–µ—Å..." onkeydown="if(event.keyCode==13) loadPage(this.value)">
            <div id="browser-page">
                <p>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –±—Ä–∞—É–∑–µ—Ä! –í–≤–µ–¥–∏—Ç–µ –∞–¥—Ä–µ—Å, –Ω–∞–ø—Ä–∏–º–µ—Ä: antivirus.com, rockstargames.com, minecraft.net, budka.nett, compshop.cat, calculator.com, freegames.ru, news.com, messenger.com</p>
            </div>
        </div>
    </div>

    <!-- –û–∫–Ω–æ –∞–Ω—Ç–∏–≤–∏—Ä—É—Å–∞ -->
    <div class="window" id="antivirus-window" style="top: 150px; left: 300px;">
        <div class="window-header">
            <span>–ê–Ω—Ç–∏–≤–∏—Ä—É—Å</span>
            <div class="window-controls">
                <button class="window-minimize" onclick="minimizeWindow('antivirus')">-</button>
                <button class="window-maximize" onclick="toggleMaximizeWindow('antivirus')">‚ñ°</button>
                <span class="window-close" onclick="closeWindow('antivirus')">X</span>
            </div>
        </div>
        <div class="window-content">
            <p>–°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã...</p>
            <button onclick="scanForVirus()">–°–∫–∞–Ω–∏—Ä–æ–≤–∞—Ç—å –∏ —É–¥–∞–ª–∏—Ç—å –≤–∏—Ä—É—Å—ã</button>
        </div>
    </div>

    <!-- –û–∫–Ω–æ –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞ -->
    <div class="window" id="calculator-window" style="top: 50px; left: 50px;">
        <div class="window-header">
            <span>–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä</span>
            <div class="window-controls">
                <button class="window-minimize" onclick="minimizeWindow('calculator')">-</button>
                <button class="window-maximize" onclick="toggleMaximizeWindow('calculator')">‚ñ°</button>
                <span class="window-close" onclick="closeWindow('calculator')">X</span>
            </div>
        </div>
        <div class="window-content">
            <input type="text" id="calculator-display" readonly>
            <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 5px;">
                <button class="calc-button" onclick="appendToCalc('7')">7</button>
                <button class="calc-button" onclick="appendToCalc('8')">8</button>
                <button class="calc-button" onclick="appendToCalc('9')">9</button>
                <button class="calc-button calc-operator" onclick="appendToCalc('/')">/</button>
                <button class="calc-button" onclick="appendToCalc('4')">4</button>
                <button class="calc-button" onclick="appendToCalc('5')">5</button>
                <button class="calc-button" onclick="appendToCalc('6')">6</button>
                <button class="calc-button calc-operator" onclick="appendToCalc('*')">*</button>
                <button class="calc-button" onclick="appendToCalc('1')">1</button>
                <button class="calc-button" onclick="appendToCalc('2')">2</button>
                <button class="calc-button" onclick="appendToCalc('3')">3</button>
                <button class="calc-button calc-operator" onclick="appendToCalc('-')">-</button>
                <button class="calc-button" onclick="appendToCalc('0')">0</button>
                <button class="calc-button" onclick="appendToCalc('.')">.</button>
                <button class="calc-button" onclick="calculate()">=</button>
                <button class="calc-button calc-operator" onclick="appendToCalc('+')">+</button>
                <button class="calc-button" onclick="clearCalc()" style="grid-column: span 4;">C</button>
            </div>
        </div>
    </div>

    <!-- –û–∫–Ω–æ Minecraft 3D -->
    <div class="window" id="minecraft-window" style="top: 50px; left: 50px;">
        <div class="window-header">
            <span>Minecraft 3D</span>
            <div class="window-controls">
                <button class="window-minimize" onclick="minimizeWindow('minecraft')">-</button>
                <button class="window-maximize" onclick="toggleMaximizeWindow('minecraft')">‚ñ°</button>
                <span class="window-close" onclick="closeWindow('minecraft')">X</span>
            </div>
        </div>
        <div class="window-content" style="padding: 0;">
            <div id="minecraft-container"></div>
        </div>
    </div>

    <!-- –û–∫–Ω–æ –ú–µ—Å—Å–µ–Ω–¥–∂–µ—Ä–∞ -->
    <div class="window" id="messenger-window" style="top: 100px; left: 100px;">
        <div class="window-header">
            <span>–ú–µ—Å—Å–µ–Ω–¥–∂–µ—Ä</span>
            <div class="window-controls">
                <button class="window-minimize" onclick="minimizeWindow('messenger')">-</button>
                <button class="window-maximize" onclick="toggleMaximizeWindow('messenger')">‚ñ°</button>
                <span class="window-close" onclick="closeWindow('messenger')">X</span>
            </div>
        </div>
        <div class="window-content">
            <div id="messenger-register">
                <h3>–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</h3>
                <div class="form-group">
                    <label>–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:</label>
                    <input type="text" id="reg-username">
                </div>
                <div class="form-group">
                    <label>–ü–∞—Ä–æ–ª—å:</label>
                    <input type="password" id="reg-password">
                </div>
                <div class="form-group">
                    <label>–ö–∞—Å—Ç–æ–º–Ω—ã–π –Ω–æ–º–µ—Ä (ID –¥–ª—è —á–∞—Ç–∞):</label>
                    <input type="text" id="reg-number" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä, mycoolid123">
                </div>
                <button class="form-button" onclick="registerUser()">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</button>
                <p>–£–∂–µ –µ—Å—Ç—å –∞–∫–∫–∞—É–Ω—Ç? <button onclick="showLogin()">–í–æ–π—Ç–∏</button></p>
                <div id="peer-status"></div>
            </div>
            <div id="messenger-login">
                <h3>–í—Ö–æ–¥</h3>
                <div class="form-group">
                    <label>–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:</label>
                    <input type="text" id="login-username">
                </div>
                <div class="form-group">
                    <label>–ü–∞—Ä–æ–ª—å:</label>
                    <input type="password" id="login-password">
                </div>
                <button class="form-button" onclick="loginUser()">–í–æ–π—Ç–∏</button>
                <p>–ù–µ—Ç –∞–∫–∫–∞—É–Ω—Ç–∞? <button onclick="showRegister()">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</button></p>
            </div>
            <div id="messenger-chat" style="display: none;">
                <h3>–ß–∞—Ç</h3>
                <p>–í–∞—à –ª–æ–≥–∏–Ω: <span id="user-id"></span></p>
                <div id="chat-messages"></div>
                <input type="text" id="chat-input" placeholder="–°–æ–æ–±—â–µ–Ω–∏–µ..." onkeydown="if(event.keyCode==13) sendMessage()">
                <button id="send-button" onclick="sendMessage()">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
                <button class="form-button" onclick="logout()">–í—ã–π—Ç–∏</button>
            </div>
        </div>
    </div>

    <!-- –û–∫–Ω–æ –°—É–ø–µ—Ä –ê—Ä—Ç—ë–º—Å–∫–∏–π –±–ª–æ–∫–Ω–æ—Ç -->
    <div class="window" id="notebook-window" style="top: 100px; left: 100px; width: 500px; height: 300px;">
        <div class="window-header">
            <span>–°—É–ø–µ—Ä –ê—Ä—Ç—ë–º—Å–∫–∏–π –±–ª–æ–∫–Ω–æ—Ç</span>
            <div class="window-controls">
                <button class="window-minimize" onclick="minimizeWindow('notebook')">-</button>
                <button class="window-maximize" onclick="toggleMaximizeWindow('notebook')">‚ñ°</button>
                <span class="window-close" onclick="closeWindow('notebook')">X</span>
            </div>
        </div>
        <div class="window-content" id="notebook-content">
            <p>–≠—Ç–æ –æ–±—ã—á–Ω—ã–π —Ç–µ–∫—Å—Ç–æ–≤—ã–π —Ñ–∞–π–ª, —Ç—Ä–æ–ª–ª—å!</p>
        </div>
    </div>

    <!-- –ê–ª–µ—Ä—Ç –≤–∏—Ä—É—Å–∞ -->
    <div id="virus-alert">
        <p>–í–ò–†–£–°! –°–∏—Å—Ç–µ–º–∞ –∑–∞—Ä–∞–∂–µ–Ω–∞!</p>
        <button onclick="document.getElementById('virus-alert').style.display = 'none';">OK</button>
    </div>

    <script>
        // Firebase Config
        const firebaseConfig = {
          apiKey: "AIzaSyBY2XQifQLL5btjQdveJFNIHDEmMLPqS-A",
          authDomain: "html-os-koteyich.firebaseapp.com",
          projectId: "html-os-koteyich",
          storageBucket: "html-os-koteyich.firebasestorage.app",
          messagingSenderId: "1022444470083",
          appId: "1:1022444470083:web:9d00bc04b79a6da99979f6"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        let isInfected = false;
        let minecraftInstalled = false;
        let connection = 'none';
        const maximizedWindows = new Set();
        let freeSpaceC = 100;
        let freeSpaceD = 200;
        let hasDiskD = false;
        let files = [
            { name: 'system32.dll', desc: '–û—Å–Ω–æ–≤–Ω–æ–π —Å–∏—Å—Ç–µ–º–Ω—ã–π —Ñ–∞–π–ª', size: '5 –ú–ë', deleted: false },
            { name: 'boot.ini', desc: '–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏', size: '1 –ö–ë', deleted: false },
            { name: 'kernel.sys', desc: '–Ø–¥—Ä–æ –û–°', size: '10 –ú–ë', deleted: false },
            { name: 'user.config', desc: '–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è', size: '2 –ö–ë', deleted: false },
            { name: 'desktop.ini', desc: '–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–µ—Å–∫—Ç–æ–ø–∞', size: '1 –ö–ë', deleted: false },
            { name: 'ntoskrnl.exe', desc: '–ó–∞–≥—Ä—É–∑—á–∏–∫ —è–¥—Ä–∞', size: '8 –ú–ë', deleted: false },
            { name: 'winlogon.exe', desc: '–ü—Ä–æ—Ü–µ—Å—Å –≤—Ö–æ–¥–∞ –≤ —Å–∏—Å—Ç–µ–º—É', size: '3 –ú–ë', deleted: false },
            { name: 'explorer.exe', desc: '–û–±–æ–ª–æ—á–∫–∞ –ø—Ä–æ–≤–æ–¥–Ω–∏–∫–∞', size: '4 –ú–ë', deleted: false },
            { name: 'svchost.exe', desc: '–•–æ—Å—Ç —Å–ª—É–∂–±', size: '2 –ú–ë', deleted: false },
            { name: 'csrss.exe', desc: '–ö–ª–∏–µ–Ω—Ç/—Å–µ—Ä–≤–µ—Ä –ø–æ–¥—Å–∏—Å—Ç–µ–º—ã', size: '1 –ú–ë', deleted: false },
            { name: 'lsass.exe', desc: '–õ–æ–∫–∞–ª—å–Ω–∞—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å', size: '2 –ú–ë', deleted: false },
            { name: 'registry.dat', desc: '–†–µ–µ—Å—Ç—Ä —Å–∏—Å—Ç–µ–º—ã', size: '50 –ú–ë', deleted: false },
            { name: 'pagefile.sys', desc: '–§–∞–π–ª –ø–æ–¥–∫–∞—á–∫–∏', size: '2 –ì–ë', deleted: false },
            { name: 'hiberfil.sys', desc: '–§–∞–π–ª –≥–∏–±–µ—Ä–Ω–∞—Ü–∏–∏', size: '1 –ì–ë', deleted: false }
        ];
        let virusInterval;
        let currentUser = null;
        let messagesListener = null;
        let calcDisplay = '';

        // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ OS
        document.getElementById('install-button').onclick = function() {
            document.getElementById('install-screen').style.display = 'none';
            showLoading('–£—Å—Ç–∞–Ω–æ–≤–∫–∞ OS...', function() {
                document.getElementById('boot-screen').style.display = 'flex';
            });
        };

        // –ó–∞–ø—É—Å–∫ OS
        document.getElementById('boot-button').onclick = function() {
            document.getElementById('boot-screen').style.display = 'none';
            showLoading('–ó–∞–≥—Ä—É–∑–∫–∞ OS...', function() {
                document.getElementById('desktop').style.display = 'block';
                document.getElementById('taskbar').style.display = 'flex';
            });
        };

        // –§—É–Ω–∫—Ü–∏—è –ø–æ–∫–∞–∑–∞ –∑–∞–≥—Ä—É–∑–∫–∏
        function showLoading(text, callback, duration = 3000) {
            document.getElementById('loading-screen').style.display = 'flex';
            document.getElementById('loading-text').innerText = text;
            document.getElementById('loading-bar').style.transition = `width ${duration / 1000}s ease-in-out`;
            document.getElementById('loading-bar').style.width = '0%';
            setTimeout(() => {
                document.getElementById('loading-bar').style.width = '100%';
            }, 100);
            setTimeout(() => {
                document.getElementById('loading-screen').style.display = 'none';
                callback();
            }, duration);
        }

        // –ß–∞—Å—ã
        function updateClock() {
            const now = new Date();
            document.getElementById('clock').innerText = now.toLocaleTimeString();
        }
        setInterval(updateClock, 1000);
        updateClock();

        // –ú–µ–Ω—é Start
        document.getElementById('start-button').onclick = function() {
            const menu = document.getElementById('start-menu');
            menu.style.display = menu.style.display === 'block' ? 'none' : 'block';
        };

        // –í—ã–∫–ª—é—á–∏—Ç—å
        function shutdown() {
            document.getElementById('start-menu').style.display = 'none';
            document.getElementById('desktop').style.display = 'none';
            document.getElementById('taskbar').style.display = 'none';
            document.querySelectorAll('.window').forEach(w => w.style.display = 'none');
            document.getElementById('boot-screen').style.display = 'flex';
        }

        // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å
        function restart() {
            document.getElementById('start-menu').style.display = 'none';
            shutdown();
            setTimeout(() => {
                document.getElementById('boot-button').onclick();
            }, 1000);
        }

        // –û—Ç–∫—Ä—ã—Ç–∏–µ –æ–∫–Ω–∞
        function openWindow(id) {
            const window = document.getElementById(id + '-window');
            window.style.display = 'flex';
            if (maximizedWindows.has(id)) {
                toggleMaximizeWindow(id);
            }
            if (id === 'files') {
                renderFilesList();
            }
            if (id === 'calculator') {
                document.getElementById('calculator-display').value = '0';
            }
            if (id === 'messenger') {
                showRegister();
            }
            if (id === 'minecraft' && minecraftInstalled) {
                initMinecraft();
            }
            if (isInfected) {
                setTimeout(showVirusAlert, 1000);
            }
        }

        // –ó–∞–∫—Ä—ã—Ç–∏–µ –æ–∫–Ω–∞
        function closeWindow(id) {
            const window = document.getElementById(id + '-window');
            window.style.display = 'none';
            maximizedWindows.delete(id);
            if (id === 'messenger' && messagesListener) {
                messagesListener.off();
                messagesListener = null;
            }
        }

        // –°–≤–æ—Ä–∞—á–∏–≤–∞–Ω–∏–µ –æ–∫–Ω–∞
        function minimizeWindow(id) {
            const window = document.getElementById(id + '-window');
            window.style.display = 'none';
        }

        // –ú–∞–∫—Å–∏–º–∏–∑–∞—Ü–∏—è/–≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –æ–∫–Ω–∞
        function toggleMaximizeWindow(id) {
            const window = document.getElementById(id + '-window');
            const btn = document.querySelector(`#${id}-window .window-maximize`);
            if (maximizedWindows.has(id)) {
                window.style.width = '';
                window.style.height = '';
                window.style.top = '';
                window.style.left = '';
                window.style.position = 'absolute';
                maximizedWindows.delete(id);
                btn.innerText = '‚ñ°';
            } else {
                window.style.width = '100vw';
                window.style.height = 'calc(100vh - 50px)';
                window.style.top = '0';
                window.style.left = '0';
                maximizedWindows.add(id);
                btn.innerText = '‚ùê';
            }
        }

        // –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —Ä–æ—É—Ç–µ—Ä—É
        function connectToRouter(type) {
            if (type === 'bad') {
                connection = 'bad';
                alert('–ü–æ–¥–∫–ª—é—á–µ–Ω–æ –∫ –ü–ª–æ—Ö–æ–º—É —Ä–æ—É—Ç–µ—Ä—É. –ó–∞–≥—Ä—É–∑–∫–∏ –±—É–¥—É—Ç –º–µ–¥–ª–µ–Ω–Ω–µ–µ.');
            } else if (type === 'good') {
                const pass = document.getElementById('password').value;
                if (pass === '656124') {
                    connection = 'good';
                    alert('–ü–æ–¥–∫–ª—é—á–µ–Ω–æ –∫ –•–æ—Ä–æ—à–µ–º—É —Ä–æ—É—Ç–µ—Ä—É. –ó–∞–≥—Ä—É–∑–∫–∏ –±—É–¥—É—Ç –±—ã—Å—Ç—Ä–µ–µ.');
                } else {
                    alert('–ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å!');
                    return;
                }
            }
            closeWindow('internet');
        }

        // –ü–æ–ª—É—á–∏—Ç—å –∑–∞–¥–µ—Ä–∂–∫—É –∑–∞–≥—Ä—É–∑–∫–∏
        function getDownloadDelay() {
            if (connection === 'none') {
                alert('–ù–µ—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É! –ü–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å —á–µ—Ä–µ–∑ –∫–Ω–æ–ø–∫—É üåê –≤ –ø–∞–Ω–µ–ª–∏ –∑–∞–¥–∞—á.');
                return null;
            }
            return connection === 'bad' ? 5000 : 2000;
        }

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–µ—Å—Ç–∞ –Ω–∞ –¥–∏—Å–∫–µ
        function checkSpace(sizeGB, disk) {
            let freeSpace = disk === 'D' ? freeSpaceD : freeSpaceC;
            let maxSpace = disk === 'D' ? 200 : 100;
            if (sizeGB > freeSpace) {
                alert(`–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–µ—Å—Ç–∞ –Ω–∞ ${disk}! –¢—Ä–µ–±—É–µ—Ç—Å—è ${sizeGB} –ì–ë, –¥–æ—Å—Ç—É–ø–Ω–æ ${freeSpace} –ì–ë –∏–∑ ${maxSpace} –ì–ë.`);
                return false;
            }
            if (disk === 'D') {
                freeSpaceD -= sizeGB;
                updateFreeSpaceD();
            } else {
                freeSpaceC -= sizeGB;
                updateFreeSpaceC();
            }
            return true;
        }

        // –û–±–Ω–æ–≤–∏—Ç—å —Å–≤–æ–±–æ–¥–Ω–æ–µ –º–µ—Å—Ç–æ C
        function updateFreeSpaceC() {
            document.getElementById('free-space-c').innerText = freeSpaceC.toFixed(2);
        }

        // –û–±–Ω–æ–≤–∏—Ç—å —Å–≤–æ–±–æ–¥–Ω–æ–µ –º–µ—Å—Ç–æ D
        function updateFreeSpaceD() {
            document.getElementById('free-space-d').innerText = freeSpaceD.toFixed(2);
        }

        // –ö—É–ø–∏—Ç—å –î–∏—Å–∫ D
        function buyDiskD() {
            hasDiskD = true;
            freeSpaceD = 200;
            document.getElementById('disk-d-info').style.display = 'block';
            updateFreeSpaceD();
            alert('–î–∏—Å–∫ D –Ω–∞ 200 –ì–ë –∫—É–ø–ª–µ–Ω –∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω!');
        }

        // –†–µ–Ω–¥–µ—Ä —Å–ø–∏—Å–∫–∞ —Ñ–∞–π–ª–æ–≤
        function renderFilesList() {
            const list = document.getElementById('files-list');
            list.innerHTML = '<h3>–°–∏—Å—Ç–µ–º–Ω—ã–µ —Ñ–∞–π–ª—ã (–î–∏—Å–∫ C):</h3>';
            let hasDeleted = false;
            files.forEach(file => {
                if (!file.deleted) {
                    const item = document.createElement('div');
                    item.className = 'file-item';
                    item.innerHTML = `
                        <span class="file-name">${file.name} - ${file.desc}</span>
                        <span class="file-size">(${file.size})</span>
                        <button class="file-delete" onclick="deleteFile('${file.name}')">–£–¥–∞–ª–∏—Ç—å</button>
                    `;
                    list.appendChild(item);
                } else {
                    hasDeleted = true;
                }
            });
            const restoreBtn = document.getElementById('restore-btn');
            restoreBtn.style.display = hasDeleted ? 'block' : 'none';
        }

        // –£–¥–∞–ª–µ–Ω–∏–µ —Ñ–∞–π–ª–∞
        function deleteFile(name) {
            const file = files.find(f => f.name === name);
            if (file) {
                file.deleted = true;
                if (name === 'kernel.sys' || name === 'ntoskrnl.exe' || name === 'registry.dat') {
                    showBSOD();
                } else {
                    alert('–§–∞–π–ª —É–¥–∞–ª—ë–Ω.');
                    renderFilesList();
                }
            }
        }

        // –ü–æ–∫–∞–∑ BSOD
        function showBSOD() {
            document.getElementById('bsod').style.display = 'flex';
            document.body.style.overflow = 'hidden';
            document.getElementById('desktop').style.display = 'none';
            document.getElementById('taskbar').style.display = 'none';
            document.querySelectorAll('.window').forEach(w => w.style.display = 'none');
        }

        // –ù–∞—á–∞—Ç—å –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã
        function startSystemRestore() {
            document.getElementById('bsod').style.display = 'none';
            showLoading('–í–û–°–°–¢–ê–ù–û–í–õ–ï–ù–ò–ï –û–°', function() {
                restoreSystemAfterLoad();
            }, 10000);
        }

        // –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏
        function restoreSystemAfterLoad() {
            restoreAllFiles(true);
            document.getElementById('desktop').style.display = 'block';
            document.getElementById('taskbar').style.display = 'flex';
            document.body.style.overflow = 'hidden';
        }

        // –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤—Å–µ —Ñ–∞–π–ª—ã
        function restoreAllFiles(fromBSOD = false) {
            files.forEach(f => f.deleted = false);
            if (!fromBSOD) {
                alert('–í—Å–µ —Å–∏—Å—Ç–µ–º–Ω—ã–µ —Ñ–∞–π–ª—ã –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã.');
                renderFilesList();
            }
        }

        // –ü–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏–µ –æ–∫–Ω–∞
        const windows = document.querySelectorAll('.window');
        windows.forEach(win => {
            const header = win.querySelector('.window-header');
            header.onmousedown = function(event) {
                if (event.target.classList.contains('window-minimize') || 
                    event.target.classList.contains('window-maximize') || 
                    event.target.classList.contains('window-close')) {
                    return;
                }
                event.preventDefault();
                let shiftX = event.clientX - win.getBoundingClientRect().left;
                let shiftY = event.clientY - win.getBoundingClientRect().top;
                function moveAt(pageX, pageY) {
                    win.style.left = pageX - shiftX + 'px';
                    win.style.top = pageY - shiftY + 'px';
                }
                function onMouseMove(event) {
                    moveAt(event.pageX, event.pageY);
                }
                document.addEventListener('mousemove', onMouseMove);
                document.onmouseup = function() {
                    document.removeEventListener('mousemove', onMouseMove);
                    document.onmouseup = null;
                };
            };
            header.ondragstart = function() {
                return false;
            };
        });

        // –ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –≤ –±—Ä–∞—É–∑–µ—Ä–µ
        function loadPage(address) {
            const page = document.getElementById('browser-page');
            const delay = getDownloadDelay();
            if (delay === null) return;
            page.innerHTML = '<p>–ó–∞–≥—Ä—É–∑–∫–∞...</p>';
            setTimeout(() => {
                address = address.toLowerCase();
                if (address === 'antivirus.com') {
                    page.innerHTML = '<h3>Antivirus.com</h3><p>–°–∫–∞—á–∞–π—Ç–µ –∞–Ω—Ç–∏–≤–∏—Ä—É—Å! (20 –ú–ë)</p><button class="download-button" onclick="downloadAntivirus()">–°–∫–∞—á–∞—Ç—å</button>';
                } else if (address === 'rockstargames.com') {
                    page.innerHTML = '<h3>RockstarGames</h3><p>Grand Theft Auto VI (–í–∏—Ä—É—Å! 15 –ì–ë)</p><button class="virus-button" onclick="downloadVirus()">–°–∫–∞—á–∞—Ç—å</button>';
                } else if (address === 'minecraft.net') {
                    page.innerHTML = '<h3>Minecraft.net</h3><p>Minecraft 3D (20 –ì–ë)</p><button class="download-button" onclick="downloadMinecraft()">–°–∫–∞—á–∞—Ç—å</button>';
                } else if (address === 'budka.nett') {
                    page.innerHTML = '<h3>–ë–£–î–ö–ê.nett</h3><p>–°—É–ø–µ—Ä –ê—Ä—Ç—ë–º—Å–∫–∏–π –±–ª–æ–∫–Ω–æ—Ç (40 –ì–ë)</p><button class="download-button" onclick="downloadNotebook()">–°–∫–∞—á–∞—Ç—å</button>';
                } else if (address === 'compshop.cat') {
                    page.innerHTML = '<h3>CompShop.cat</h3><p>–ö—É–ø–∏—Ç–µ –î–∏—Å–∫ D –Ω–∞ 200 –ì–ë!</p><button class="buy-button" onclick="buyDiskD()">–ö—É–ø–∏—Ç—å (100$)</button>';
                } else if (address === 'calculator.com') {
                    page.innerHTML = '<h3>Calculator.com</h3><p>–°–∫–∞—á–∞–π—Ç–µ –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä! (5 –ú–ë)</p><button class="download-button" onclick="downloadCalculator()">–°–∫–∞—á–∞—Ç—å</button>';
                } else if (address === 'freegames.ru') {
                    page.innerHTML = '<h3>FreeGames.ru</h3><p>–ë–µ—Å–ø–ª–∞—Ç–Ω—ã–µ –∏–≥—Ä—ã (–í–∏—Ä—É—Å! 8 –ì–ë)</p><button class="virus-button" onclick="downloadVirus()">–°–∫–∞—á–∞—Ç—å –∏–≥—Ä—É</button>';
                } else if (address === 'news.com') {
                    page.innerHTML = '<h3>News.com</h3><p>–ù–æ–≤–æ—Å—Ç–∏ –¥–Ω—è (–ë–µ–∑–æ–ø–∞—Å–Ω–æ, 0 –ú–ë)</p><p>–ü–æ—Å–ª–µ–¥–Ω–∏–µ –Ω–æ–≤–æ—Å—Ç–∏: –ú–∏—Ä –≤ –ø–æ—Ä—è–¥–∫–µ.</p>';
                } else if (address === 'messenger.com') {
                    page.innerHTML = '<h3>Messenger.com</h3><p>–û—Ç–∫—Ä–æ–π—Ç–µ –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä –¥–ª—è —á–∞—Ç–∞ (0 –ú–ë)</p><button class="download-button" onclick="openWindow(\'messenger\')">–û—Ç–∫—Ä—ã—Ç—å</button>';
                } else {
                    page.innerHTML = '<p>–°—Ç—Ä–∞–Ω–∏—Ü–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞.</p>';
                }
            }, delay);
        }

        // –°–∫–∞—á–∏–≤–∞–Ω–∏–µ —Å –≤—ã–±–æ—Ä–æ–º –¥–∏—Å–∫–∞
        function downloadWithDiskChoice(sizeGB, downloadFunc, successMsg) {
            const delay = getDownloadDelay();
            if (delay === null) return;
            alert('–°–∫–∞—á–∏–≤–∞–Ω–∏–µ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è...');
            setTimeout(() => {
                if (hasDiskD) {
                    let disk = prompt('–ù–∞ –∫–∞–∫–æ–π –¥–∏—Å–∫ —Å–∫–∞—á–∞—Ç—å? (C –∏–ª–∏ D)');
                    if (disk !== 'C' && disk !== 'D') {
                        alert('–ù–µ–≤–µ—Ä–Ω—ã–π –≤—ã–±–æ—Ä. –°–∫–∞—á–∏–≤–∞–Ω–∏–µ –æ—Ç–º–µ–Ω–µ–Ω–æ.');
                        return;
                    }
                    if (!checkSpace(sizeGB, disk)) return;
                } else {
                    if (!checkSpace(sizeGB, 'C')) return;
                }
                downloadFunc();
                alert(successMsg);
            }, delay);
        }

        function downloadAntivirus() {
            downloadWithDiskChoice(0.02, function() {
                document.getElementById('antivirus-icon').style.display = 'block';
            }, '–ê–Ω—Ç–∏–≤–∏—Ä—É—Å —Å–∫–∞—á–∞–Ω!');
        }

        function downloadVirus() {
            const delay = getDownloadDelay();
            if (delay === null) return;
            alert('–°–∫–∞—á–∏–≤–∞–Ω–∏–µ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è...');
            setTimeout(() => {
                isInfected = true;
                const desktop = document.getElementById('desktop');
                desktop.style.background = 'linear-gradient(to bottom, #8B0000, #DC143C)';
                desktop.classList.add('infected');
                if (virusInterval) clearInterval(virusInterval);
                virusInterval = setInterval(showVirusAlert, 3000);
                alert('–í–∏—Ä—É—Å —Å–∫–∞—á–∞–Ω! –°–∏—Å—Ç–µ–º–∞ –∑–∞—Ä–∞–∂–µ–Ω–∞.');
            }, delay);
        }

        function downloadMinecraft() {
            downloadWithDiskChoice(20, function() {
                minecraftInstalled = true;
                document.getElementById('minecraft-icon').style.display = 'block';
            }, 'Minecraft 3D —Å–∫–∞—á–∞–Ω!');
        }

        function downloadNotebook() {
            downloadWithDiskChoice(40, function() {
                openWindow('notebook');
            }, '–°—É–ø–µ—Ä –ê—Ä—Ç—ë–º—Å–∫–∏–π –±–ª–æ–∫–Ω–æ—Ç —Å–∫–∞—á–∞–Ω! (–≠—Ç–æ —Ç—Ä–æ–ª–ª—å)');
        }

        function downloadCalculator() {
            downloadWithDiskChoice(0.005, function() {
                document.getElementById('calculator-icon').style.display = 'block';
            }, '–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä —Å–∫–∞—á–∞–Ω!');
        }

        // –ê–ª–µ—Ä—Ç –≤–∏—Ä—É—Å–∞
        function showVirusAlert() {
            document.getElementById('virus-alert').style.display = 'block';
        }

        // –°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ
        function scanForVirus() {
            if (isInfected) {
                isInfected = false;
                const desktop = document.getElementById('desktop');
                desktop.style.background = 'linear-gradient(to bottom, #1e3c72, #2a5298)';
                desktop.classList.remove('infected');
                if (virusInterval) {
                    clearInterval(virusInterval);
                    virusInterval = null;
                }
                alert('–í–∏—Ä—É—Å —É–¥–∞–ª—ë–Ω!');
            } else {
                alert('–°–∏—Å—Ç–µ–º–∞ —á–∏—Å—Ç–∞.');
            }
        }

        // –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä —Ñ—É–Ω–∫—Ü–∏–∏
        function appendToCalc(value) {
            calcDisplay += value;
            document.getElementById('calculator-display').value = calcDisplay;
        }
        function clearCalc() {
            calcDisplay = '';
            document.getElementById('calculator-display').value = '0';
        }
        function calculate() {
            try {
                calcDisplay = eval(calcDisplay).toString();
                document.getElementById('calculator-display').value = calcDisplay;
            } catch {
                calcDisplay = '–û—à–∏–±–∫–∞';
                document.getElementById('calculator-display').value = calcDisplay;
            }
        }

        // –ú–µ—Å—Å–µ–Ω–¥–∂–µ—Ä
        function showRegister() {
            document.getElementById('messenger-register').style.display = 'block';
            document.getElementById('messenger-login').style.display = 'none';
            document.getElementById('messenger-chat').style.display = 'none';
        }
        function showLogin() {
            document.getElementById('messenger-register').style.display = 'none';
            document.getElementById('messenger-login').style.display = 'block';
            document.getElementById('messenger-chat').style.display = 'none';
        }
        function showRegisterFromLogin() {
            showRegister();
        }
        function showChat() {
            document.getElementById('messenger-register').style.display = 'none';
            document.getElementById('messenger-login').style.display = 'none';
            document.getElementById('messenger-chat').style.display = 'block';
            document.getElementById('user-id').innerText = currentUser.username;
            startMessageListener();
        }

        function registerUser() {
            const username = document.getElementById('reg-username').value.trim();
            const password = document.getElementById('reg-password').value;
            const number = document.getElementById('reg-number').value.trim();
            if (username && password && number) {
                db.ref('users/' + username).once('value').then((snapshot) => {
                    if (snapshot.exists()) {
                        alert('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å —Ç–∞–∫–∏–º –∏–º–µ–Ω–µ–º —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç!');
                    } else {
                        db.ref('users/' + username).set({
                            password: password,
                            id: number
                        }).then(() => {
                            alert('–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞! –í–∞—à ID: ' + number);
                            showLogin();
                        }).catch((error) => {
                            alert('–û—à–∏–±–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏: ' + error.message);
                        });
                    }
                });
            } else {
                alert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è!');
            }
        }

        function loginUser() {
            const username = document.getElementById('login-username').value.trim();
            const password = document.getElementById('login-password').value;
            if (username && password) {
                db.ref('users/' + username).once('value').then((snapshot) => {
                    if (snapshot.exists()) {
                        const userData = snapshot.val();
                        if (userData.password === password) {
                            currentUser = {
                                username: username,
                                id: userData.id
                            };
                            showChat();
                        } else {
                            alert('–ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å!');
                        }
                    } else {
                        alert('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω!');
                    }
                }).catch((error) => {
                    alert('–û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞: ' + error.message);
                });
            } else {
                alert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è!');
            }
        }

        function logout() {
            if (messagesListener) {
                messagesListener.off();
                messagesListener = null;
            }
            currentUser = null;
            document.getElementById('chat-messages').innerHTML = '';
            showRegister();
        }

        function startMessageListener() {
            const messagesRef = db.ref('messages');
            messagesListener = messagesRef.on('value', (snapshot) => {
                const messagesDiv = document.getElementById('chat-messages');
                messagesDiv.innerHTML = '';
                snapshot.forEach((childSnapshot) => {
                    const messageData = childSnapshot.val();
                    addMessage(messageData.from + ': ' + messageData.message);
                });
                messagesDiv.scrollTop = messagesDiv.scrollHeight;
            });
        }

        function sendMessage() {
            const messageInput = document.getElementById('chat-input');
            const message = messageInput.value.trim();
            if (message && currentUser) {
                db.ref('messages').push({
                    from: currentUser.username,
                    message: message,
                    timestamp: Date.now()
                }).then(() => {
                    messageInput.value = '';
                }).catch((error) => {
                    alert('–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏: ' + error.message);
                });
            }
        }

        function addMessage(msg) {
            const messagesDiv = document.getElementById('chat-messages');
            const messageDiv = document.createElement('div');
            messageDiv.className = 'message';
            messageDiv.innerText = msg;
            messagesDiv.appendChild(messageDiv);
        }

        // Minecraft
        let scene, camera, renderer, controls, composer;
        function initMinecraft() {
            const container = document.getElementById('minecraft-container');
            if (!container) return;
            while (container.firstChild) container.removeChild(container.firstChild);
            scene = new THREE.Scene();
            camera = new THREE.PerspectiveCamera(75, 600 / 400, 0.1, 1000);
            renderer = new THREE.WebGLRenderer({ antialias: false });
            renderer.setSize(600, 400);
            renderer.setPixelRatio(1);
            container.appendChild(renderer.domElement);
            const light = new THREE.DirectionalLight(0xffffff, 1);
            light.position.set(5, 5, 5);
            scene.add(light);
            scene.add(new THREE.AmbientLight(0x404040));
            const blockSize = 1;
            const geometry = new THREE.BoxGeometry(blockSize, blockSize, blockSize);
            const materialGrass = new THREE.MeshBasicMaterial({ color: 0x228B22 });
            const materialDirt = new THREE.MeshBasicMaterial({ color: 0x8B4513 });
            const blocks = [];
            for (let x = -10; x <= 10; x++) {
                for (let z = -10; z <= 10; z++) {
                    const dirt = new THREE.Mesh(geometry, materialDirt);
                    dirt.position.set(x, -1, z);
                    scene.add(dirt);
                    blocks.push(dirt);
                    const grass = new THREE.Mesh(geometry, materialGrass);
                    grass.position.set(x, 0, z);
                    scene.add(grass);
                    blocks.push(grass);
                }
            }
            controls = new THREE.PointerLockControls(camera, renderer.domElement);
            scene.add(controls.getObject());
            container.addEventListener('click', () => controls.lock());
            const velocity = new THREE.Vector3();
            const direction = new THREE.Vector3();
            const onKeyDown = function (event) {
                switch (event.code) {
                    case 'KeyW': velocity.z = -0.1; break;
                    case 'KeyS': velocity.z = 0.1; break;
                    case 'KeyA': velocity.x = -0.1; break;
                    case 'KeyD': velocity.x = 0.1; break;
                    case 'Space': if (controls.getObject().position.y < 1) velocity.y = 0.2; break;
                }
            };
            const onKeyUp = function (event) {
                switch (event.code) {
                    case 'KeyW': case 'KeyS': velocity.z = 0; break;
                    case 'KeyA': case 'KeyD': velocity.x = 0; break;
                }
            };
            document.addEventListener('keydown', onKeyDown);
            document.addEventListener('keyup', onKeyUp);
            const raycaster = new THREE.Raycaster();
            const mouse = new THREE.Vector2(0, 0);
            container.addEventListener('mousedown', (event) => {
                mouse.x = (event.clientX / 600) * 2 - 1;
                mouse.y = - (event.clientY / 400) * 2 + 1;
                raycaster.setFromCamera(mouse, camera);
                const intersects = raycaster.intersectObjects(blocks);
                if (intersects.length > 0) {
                    const intersect = intersects[0];
                    if (event.button === 0) {
                        scene.remove(intersect.object);
                        blocks.splice(blocks.indexOf(intersect.object), 1);
                    } else if (event.button === 2) {
                        const newBlock = new THREE.Mesh(geometry, materialGrass);
                        newBlock.position.copy(intersect.point.add(intersect.face.normal));
                        scene.add(newBlock);
                        blocks.push(newBlock);
                    }
                }
            });
            composer = new THREE.EffectComposer(renderer);
            const renderPass = new THREE.RenderPass(scene, camera);
            composer.addPass(renderPass);
            const pixelPass = new THREE.ShaderPass(THREE.PixelShader);
            pixelPass.uniforms["resolution"].value = new THREE.Vector2(600, 400);
            pixelPass.uniforms["pixelSize"].value = 4;
            composer.addPass(pixelPass);
            const copyPass = new THREE.ShaderPass(THREE.CopyShader);
            composer.addPass(copyPass);
            camera.position.y = 2;
            function animate() {
                requestAnimationFrame(animate);
                if (controls.isLocked) {
                    direction.z = velocity.z;
                    direction.x = velocity.x;
                    direction.normalize();
                    controls.moveForward(direction.z * 0.1);
                    controls.moveRight(direction.x * 0.1);
                    velocity.y -= 0.01;
                    controls.getObject().position.y += velocity.y;
                    if (controls.getObject().position.y < 1) {
                        velocity.y = 0;
                        controls.getObject().position.y = 1;
                    }
                }
                composer.render();
            }
            animate();
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        document.getElementById('taskbar').style.display = 'none';
        document.getElementById('boot-screen').style.display = 'none';
        updateFreeSpaceC();
    </script>
</body>
</html>
